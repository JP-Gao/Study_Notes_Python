

install.packages("rjson")
  
library("rjson")

json_file <- "/Users/yangguodaxia/Dropbox/Tech/Ube_case_study/logins.json"
json_data <- fromJSON(paste(readLines(json_file), collapse=""))


head(json_data)
class(json_data)





1. Between 12/1/2014 10:00:00 PST & 12/8/2014 17:00:00 PST, how many completed
trips were requested on iphones in City #5? On android phones? (Hint: look at
the trips.status column)

on city 5

select 
count(distinct id)
from trips as t
where status = 'completed' and city_id = 5
request_at between ('12/1/2014 10:00:00 PST','12/8/2014 17:00:00 PST')

on Android 

select 
count(distinct id)
from trips as t
where status = 'completed' and request_device = 'android' and 
request_at between ('12/1/2014 10:00:00 PST','12/8/2014 17:00:00 PST')





2. In City #8, how many unique, currently unbanned clients completed a trip in October
2014? Of these, how many trips did each client take?


select 
count(distinct t.client_id) as trips_per_client

from trips as t
inner join (
  select usersid, sum(1) as freq_reg
  from users
  group by userid # insure uniqueness of users
  where role = 'client' and banned = 0
) as u

on t.client_id = u.usersid 
where t.status = 'completed' and request_at = 'October 2014' and t.city = 8;

select 
t.client_id
count(*) as trips_per_client,

from trips as t
inner join (
  select usersid, sum(1) as freq_reg
  from users
  group by userid # insure uniqueness of users
  where role = 'client' and banned = 0
) as u

on t.client_id = u.usersid 
where t.status = 'completed' and request_at = 'October 2014' and t.city = 8;
group by t.client_id;




3. In City #8, how many unique, currently unbanned clients completed a trip between
9/10/2014 and 9/20/2014 with drivers who started between 9/1/2014 and
9/10/2014 and are currently banned?

select 
count(distinct t.client_id) as trips_per_client

from trips as t
inner join (
  select usersid, sum(1) as freq_reg
  from users
  group by userid # insure uniqueness of users
  where role = 'client' and banned = 0
) as u

on u.usersid = t.client_id

inner join (
  select usersid, sum(1) as freq_reg
  from users
  group by userid # insure uniqueness of users
  where role = 'driver'  and banned = 1 and 
  creationtime between '9/1/2014' and '9/10/2014'
) as d

on u.usersid = d.driver_id

where t.status = 'completed' and 
request_at between '9/10/2014' and '9/20/2014' and
t.city = 8;



4. For clients that signed up in November 2014:
  a) How many trips from this group were requested from each of the possible
device types (Hint: look at the trips.request_device column)?
b) How many clients from this group have not completed a trip yet?


select 
request_device
count(distinct t.id) as trips_per_device

from trips as t
inner join (
  select usersid, sum(1) as freq_reg
  from users
  group by userid # insure uniqueness of users
  where role = 'client' and creationtime in 'Nov 2014'
) as u
on u.usersid = t.client_id
where t.status = 'completed'
group by t.request_device;


b

select 
count(distinct u.usersid) as client_no_trip

from trips as t
full join (
  select usersid, sum(1) as freq_reg
  from users
  group by userid # insure uniqueness of users
  where role = 'client' and creationtime in 'Nov 2014'
) as u
on u.usersid = t.client_id
where u.user_id is NULL;

5. What is the 30-day rate of conversion from client signup to active rider by month of
signup? (i.e., for any month, what percentage of signups went on to complete a
         trip within 30 days of their signup date?)


select 
    sum(u.userid = t.client_id) / 
      count(distinct u.userid) as conv_rate
    
from trips as t
full join (
  select usersid, 
  min(creationtime) as creationtime ,
  sum(1) as freq_reg
  from users
  group by userid # insure uniqueness of users
  where role = 'client'
) as u
where t.status = 'completed' and 
request_at between u.creationtime and u.creationtime + 30;


Extra Credit: Add to your statement in 2) to exclude Uber admins. Uber admins have
an email address from @uber.com (example: ‘jsmith@uber.com’).









